<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/asciidoctor.css" rel="stylesheet">
    <link href="css/base.css" rel="stylesheet">
    <link href="css/tabzilla.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="alternate" href="feed.xml" title="Hawkular Blog - RSS" type="application/rss+xml">

  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">
    <div id="wrap">
      <div class="dropup">
        <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
        <script>
            window.addEventListener('load', function() {
                 renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
        </script>
      </div>

	<!-- Fixed navbar -->
    <nav class="navbar navbar-fixed-top" role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button class="navbar-toggle collapsed" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Home</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li><a href="index.html">Hawkular</a></li>
            <li>
              <a href="docs/user/getting-started.html">Getting
                  Started</a>
            </li>
            <li class=""><a href="downloads.html">Downloads</a></li>
            <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
              Documentation
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li>
                <a href="docs/user/getting-started.html">User Documentation</a>
              </li>
              <li>
                <a href="docs/dev/development.html">Developer Documentation</a>
              </li>
              <li class="menu-item dropdown dropdown-submenu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">REST API</a>
                <ul class="dropdown-menu">
                  <li class="menu-item ">
                    <a href="docs/rest/rest-alerts.html">Alerts</a>
                  </li>
                  <li class="menu-item ">
                    <a href="docs/rest/rest-inventory.html">Inventory</a>
                  </li>
                  <li class="menu-item ">
                    <a href="docs/rest/rest-metrics.html">Metrics</a>
                  </li>
                </ul>
              </li>
            </ul>
            <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
              Community
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li>
                <a href="community/index.html">Home</a>
              </li>
              <li>
                <a href="community/join.html">Join</a>
              </li>
              <li>
                <a href="license.html">License</a>
              </li>
              <li>
                <a href="https://travis-ci.org/hawkular/builds">CI Builds</a>
              </li>
            </ul></li>
            <li class=""><a href="blog.html">Blog</a></li>
          </ul>
        </div>
      </div>
    </nav>


<section class="main-banner blog-mainbanner">
    <div class="container">
        <h1>Hawkular Blog</h1>
    </div>
</section>


<div class="blog-container">
            <a href="blog/2015/2015-04-08-1.html"><h1>Testing collectd integration</h1></a>
            <p>08 April 2015, by Thomas Segismont</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Hawkular Metrics is able to store data coming from <a href="http://collectd.org/" target="_blank">collectd</a>. To enable this
feature, you need to start the
<a href="https://github.com/hawkular/hawkular-metrics/tree/master/clients/ptranslator" target="_blank">ptrans</a> proxy, point it
to your Metrics server, and configure the collectd network plugin to send data to ptrans.</p>
</div>
<div id="img-stack" class="imageblock">
<div class="content">
<img src="../../img/blog/2015/collectd-ptrans-metrics.png" alt="collectd/ptrans/metrics stack">
</div>
<div class="title">Figure 1. collectd/ptrans/metrics stack</div>
</div>
<div class="paragraph">
<p><a href="https://commons.wikimedia.org/wiki/File:Logo_der_Software_collectd.svg#/media/File:Logo_der_Software_collectd.svg">
collectd logo by Florian Forster. Licensed under CC BY-SA 2.0 de via Wikimedia Commons</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="regression_test_requirements">Regression test requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To make sure the collectd/ptrans/Hawkular stack never gets broken, we wanted to have an integration test. This test
should fill the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>do not fail the build on machines where collectd is not available (non-Linux developers machines, or simply machines
where collectd is not installed)</p>
</li>
<li>
<p>run on Travis-CI, where each pull request is tested before being merged</p>
</li>
<li>
<p>make sure all data sent from collectd lands on the Hawkular Metrics server</p>
</li>
<li>
<p>run as quickly as possible</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s an outline of the implementation.</p>
</div>
<div class="sect2">
<h3 id="skip_test_when_collectd_is_not_available">Skip test when collectd is not available</h3>
<div class="paragraph">
<p><a href="https://github.com/junit-team/junit/wiki/Assumptions-with-assume" target="_blank">jUnit Assumptions</a> provide a nice way
to test the presence of external dependencies. The default jUnit runner will skip the test if the assumption fails. So
skipping the test when collectd is not available is just a matter of testing if the collectd binary exists, is a regular
file, and is executable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private static final String COLLECTD_PATH = System.getProperty("collectd.path", "/usr/sbin/collectd");

// ...

@Before
public void setUp() throws Exception {
    // ...
    assumeCollectdIsPresent();
    // ...
}

private void assumeCollectdIsPresent() {
    Path path = Paths.get(COLLECTD_PATH);
    assumeTrue(COLLECTD_PATH + " does not exist", Files.exists(path));
    assumeTrue(COLLECTD_PATH + " is not a file", Files.isRegularFile(path));
    assumeTrue(COLLECTD_PATH + " is not executable", Files.isExecutable(path));
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="run_on_travis_ci">Run on Travis-CI</h3>
<div class="paragraph">
<p><a href="http://docs.travis-ci.com/user/installing-dependencies/">
Travis lets you customize the virtual running the build</a>. Installing packages on the Ubuntu-based VM is very
straightforward, just add a couple of lines in the <code>before_install</code> target of your <code>.travis.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">before_install:
- sudo apt-get update -qq
- sudo apt-get install -qq collectd collectd-utils</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verify_data_has_landed_on_the_metrics_server">Verify data has landed on the Metrics server</h3>
<div class="paragraph">
<p>collectd lets you configure one or more <em>write plugins</em>. The network plugin is required to send data to ptrans. We also
activate the csv plugin and make it log the measurements to <em>stdout</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-conf" data-lang="conf">LoadPlugin csv
&lt;Plugin csv&gt;
    DataDir stdout
&lt;/Plugin&gt;

LoadPlugin network
&lt;Plugin network&gt;
    Server "127.0.0.1" "25826"
    ReportStats false
&lt;/Plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we start collectd, preventing it to fork to the background with the <code>-f</code> option, and wait until a minimum number
of measurements has been sent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Test
public void shouldFindCollectdMetricsOnServer() throws Exception {

    // ...

    ImmutableList.Builder&lt;String&gt; collectdCmd = ImmutableList.builder();
    collectdCmd.add(COLLECTD_PATH, "-C", collectdConfFile.getAbsolutePath(), "-f");
    collectdProcessBuilder.command(collectdCmd.build());
    collectdProcess = collectdProcessBuilder.start();

    waitForCollectdValues();

    // ...

}

private void waitForCollectdValues() throws Exception {
    long c;
    do {
        Thread.sleep(MILLISECONDS.convert(1, SECONDS));
        c = Files.lines(collectdOut.toPath())
                 .filter(l -&gt; l.startsWith("PUTVAL"))
                 .collect(counting());
    } while (c &lt; MINIMUM);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When enough measurements have been collected and sent, all we need to do is to parse collectd <em>stdout</em> and compare with
server data, which can be loaded with an HTTP request.</p>
</div>
</div>
<div class="sect2">
<h3 id="run_as_quickly_as_possible">Run as quickly as possible</h3>
<div class="paragraph">
<p>At this point, all the ingredients can be combined to build an integration test. But the experience showed that running
it could take quite some time, even if the minimum number of measurements was low, and data collectd frequently (every
second).</p>
</div>
<div class="paragraph">
<p>A bit of investigation demonstrated that the test was spending an unexpected amount of time in  the
<code>waitForCollectdValues</code> method. It turned out that buffering of collectd output was the cause. To avoid it, we can use
the <code>stdbuf</code> tool from GNU <code>coreutils</code>: as explained in the manual page, it&#8217;s a tool to run a command "with modified
buffering operations for its standard streams".</p>
</div>
<div class="paragraph">
<p>With this slight modification, the test runs in a few seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">File stdbuf = new File("/usr/bin/stdbuf");
ImmutableList.Builder&lt;String&gt; collectdCmd = ImmutableList.builder();
if (stdbuf.exists() &amp;&amp; stdbuf.canExecute()) {
    collectdCmd.add(stdbuf.getAbsolutePath(), "-o0", "-e0");
}
collectdCmd.add(COLLECTD_PATH, "-C", collectdConfFile.getAbsolutePath(), "-f");
collectdProcessBuilder.command(collectdCmd.build());
collectdProcess = collectdProcessBuilder.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it!</p>
</div>
</div>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2015/2015-04-01-1.html"><h1>Hawkular Discontinued</h1></a>
            <p>01 April 2015, by Heiko W. Rupp</p>
            <p><div class="paragraph">
<p>Yesterday on March 31st, we had a good number of Meetings with other folks of JBoss in the new new
Red Hat office in Newcastle, called <em>The Pub</em>.
Among others we were also discussing the future of Monitoring. After all the beers^w discussions we have decided to
discontinue Hawkular.</p>
</div>
<div class="paragraph">
<p>We found out that software is always at fault:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it does not have all the features users want</p>
</li>
<li>
<p>it is too slow (always!)</p>
</li>
<li>
<p>it uses too much memory</p>
</li>
<li>
<p>it uses too much cpu</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So instead of investing more time and effort into Hawkular, we will replace it with this new Microservice</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public static String isHealthy(String resource) {
    return "no";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the existing Hawkular source code will be donated to the 1. Association of Possibly Retired Invariant Lines of
code.</p>
</div>
<div class="paragraph">
<p>Thanks for your attention</p>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2015/2015-03-30-1.html"><h1>Dockerized Hawkular builds available</h1></a>
            <p>30 March 2015, by Heiko W. Rupp</p>
            <p><div class="paragraph">
<p>As described earlier, we have assembled all the components of Hawkular into a single package, the <em>Kettle</em>.
This allows you to just build/download one package, start and work with it instead of caring of the individual
sub-packages.</p>
</div>
<div class="paragraph">
<p>To make the process to play with Hawkular even easier, we have also created a build-pipeline that creates a Docker
image out of the Kettle and publishes it to Docker Hub as hawkular/hawkular.</p>
</div>
<div class="paragraph">
<p>You can download and run them like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$ docker run -d -p 8081:8080 hawkular/hawkular</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the download of the image has finished, it will take a while until Hawkular is fully started up.
When it is up, you can reach the Hawkular UI at <a href="http://localhost:8081/" class="bare">http://localhost:8081/</a>  ( If you are
running docker on OS/X via boot2docker, you need to use the IP address that is stored in the <code>DOCKER_HOST</code>
environment variable instead of <code>localhost</code>.)</p>
</div>
<div class="paragraph">
<p>More information is available in the
<a href="/docs/user/getting-started">Getting started</a> document.</p>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2015/2015-02-24-1.html"><h1>The Kettle starts boiling</h1></a>
            <p>24 February 2015, by Heiko W. Rupp</p>
            <p><div class="paragraph">
<p>We have been working hard the last weeks to integrate the individual pieces of hawkular into some <em>good old
distribution</em>, basically a thingy you can check out, unzip and run. And here it is, the <em>Kettle</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/Kettle.png" alt="Kettle">
</div>
</div>
<div class="paragraph">
<p>To build the Kettle you basically checkout the Hawkular main repository and run <code>mvn install</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">git clone https://github.com/hawkular/hawkular.git
cd hawkular
mvn install -Pdev -Dlicense.skip
cd kettle/target
cd wildfly-8.2.0.Final
bin/standalone.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then point your web browser at <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a> and use Hawkular.</p>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2015/2015-02-16-1.html"><h1>Hawkular-Metrics 0.2.7 release</h1></a>
            <p>16 February 2015, by Heiko W. Rupp</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Hawkular-metrics has published under its old name <em>rhq-metrics</em> its version 0.2.7 release.
From Stefans announcement:</p>
</div>
<div class="paragraph">
<p>I want to summarize the latest release of the RHQ Metrics project and the future of the project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rhq_metrics_migrates_to_hawkular_organization">RHQ Metrics migrates to Hawkular organization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Release 0.2.7 of the RHQ Metrics is the last one from the current repository. But do not panic! Beyond the mechanics of the transfer and rename, the development will continue with the regular crew.</p>
</div>
<div class="paragraph">
<p>For the migration, two project repositories (rhq-metrics and rhq-metrics-openshift) will just be transferred to the Hawkular organization. The code from rhqm-charts was already moved to Hawkular, so we will just close the RHQ repository. We will have a follow up communication once all the infrastructure is in place under the new organization.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rhq_metrics_0_2_7_was_released_today">RHQ Metrics 0.2.7 was released today</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release has mainly stability fixes and minor enhancements. The Keycloak integration was delayed and not part of this release (as announced in the planning notes). For more details checkout the Github release notes.</p>
</div>
<div class="paragraph">
<p>Github Release:
<a href="https://github.com/rhq-project/rhq-metrics/releases/tag/0.2.7" class="bare">https://github.com/rhq-project/rhq-metrics/releases/tag/0.2.7</a></p>
</div>
<div class="paragraph">
<p>JBoss Nexus Maven artifacts:
<a href="http://origin-repository.jboss.org/nexus/content/repositories/public/org/rhq/metrics/" class="bare">http://origin-repository.jboss.org/nexus/content/repositories/public/org/rhq/metrics/</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="openshift_cartridge_for_rhq_metrics_0_2_7">OpenShift Cartridge for RHQ Metrics 0.2.7</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The cartridge supports RHQ Metrics 0.2.7, 0.2.6, and 0.2.5. Just a reminder, the cartridge is the simplest and easiest way to get a public facing instance of RHQ Metrics in just a few minutes with a single command. The cartridge configures Cassandra, Wildfly, and RHQ Metrics (REST interface and UI console) to run in a single gear. For more details please visit the Github repository of the project.</p>
</div>
<div class="paragraph">
<p>Sample command to create a new RHQ Metrics deployment:
rhc app create test_app <a href="https://raw.githubusercontent.com/rhq-project/rhq-metrics-openshift/master/metadata/manifest.yml" class="bare">https://raw.githubusercontent.com/rhq-project/rhq-metrics-openshift/master/metadata/manifest.yml</a></p>
</div>
<div class="paragraph">
<p>Github Repository:
<a href="https://github.com/rhq-project/rhq-metrics-openshift" class="bare">https://github.com/rhq-project/rhq-metrics-openshift</a></p>
</div>
<div class="paragraph">
<p>A big "Thank you!" goes to John Sanda, Mike Thompson, Heiko Rupp, and Thomas Segismont for their project contributions.</p>
</div>
<div class="paragraph">
<p>Any discussion, suggestions or contributions are more than welcomed; so feel free to reply to this email or comment directly on the various forum threads.</p>
</div>
<div class="paragraph">
<p>Thank you,
Stefan Negrea</p>
</div>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />




    <a href=feed.xml><i class="fa fa-rss"></i> RSS Feed</a>
</div>


		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        
      </div>
    </div>

    <section class="redhat">
      <div class="container">
        <p class="text-center">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="/img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit">&copy; 2015 | Baked with <a href="http://jbake.org">JBake v2.3.2</a></p>
    <p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p>
      </div>
    </section>
    
    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="js/jquery-1.11.2.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="js/jbossorg-tabzilla.js"></script>
    <script src="js/behavior.js"></script>
    <script src="js/prettify.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
