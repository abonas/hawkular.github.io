<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular - Client Configuration Guide</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/tabzilla.css" rel="stylesheet">
    <link href="../../../css/styles.css" rel="stylesheet">
    <link href="../../../css/prettify.css" rel="stylesheet">
    <link href="../../../css/ekko-lightbox.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="../../../js/moment.min.js"></script>
    <script src="../../../js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../favicon.ico">
    
  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">
    <div id="wrap">
      <div class="dropup">
        <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
        <script>
            window.addEventListener('load', function() {
                 renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
        </script>
      </div>

    	<!-- Fixed navbar -->
        <nav class="navbar navbar-fixed-top" role="navigation">
          <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button class="navbar-toggle collapsed" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../index.html">Home</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav">
                <li><a href="../../../index.html">Hawkular</a></li>
                <li><a href="../../../docs/overview.html">Overview</a></li>
                <li><a href="../../../docs/user/quick-start.html">Quick Start</a></li>
                <li class=""><a href="../../../downloads.html">Downloads</a></li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Metrics<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li>
                      <a href="../../../docs/components/metrics/index.html">User Guide</a>
                    </li>
                    <li>
                      <a href="../../../docs/rest/rest-metrics.html">REST API</a>
                    </li>
                  </ul>
                </li>
                <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                  Documentation
                  <span class="caret"></span>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li>
                    <a href="../../../docs/user/user-guide.html">User Guide</a>
                  </li>
                  <li>
                    <a href="../../../docs/user/installation-guide.html">Installation Guide</a>
                  </li>
                  <!--li>
                    <a href="../../../docs/dev/terms.html">Used Terms</a>
                  </li-->
                  <li class="menu-item dropdown dropdown-submenu">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">REST API</a>
                    <ul class="dropdown-menu">
                      <li class="menu-item ">
                        <a href="../../../docs/rest/rest-alerts.html">Alerts</a>
                      </li>
                      <li class="menu-item ">
                        <a href="../../../docs/rest/rest-btm.html">Business Transaction Management</a>
                      </li>
                        <li class="menu-item ">
                            <a href="../../../docs/rest/rest-datamining.html">Data Mining</a>
                        </li>
                      <li class="menu-item ">
                        <a href="../../../docs/rest/rest-inventory.html">Inventory</a>
                      </li>
                      <li class="menu-item ">
                        <a href="../../../docs/rest/rest-metrics.html">Metrics</a>
                      </li>
                    </ul>
                  </li>
                  <li class="menu-item dropdown dropdown-submenu">
                    <a href="javascript:;" onclick="return false;" class="dropdown-toggle" data-toggle="dropdown">Sub-projects</a>
                    <ul class="dropdown-menu">
                      <li class="menu-item ">
                        <a href="../../../docs/components/alerts/index.html">Alerts</a>
                      </li>
                      <li class="menu-item ">
                        <a href="../../../docs/components/btm/index.html">Business Transaction Management</a>
                      </li>
                      <li class="menu-item ">
                        <a href="../../../docs/components/datamining/index.html">Data Mining</a>
                      </li>
                      <li class="menu-item ">
                        <a href="../../../docs/components/inventory/index.html">Inventory</a>
                      </li>
                      <li class="menu-item ">
                        <a href="../../../docs/components/metrics/index.html">Metrics</a>
                      </li>
                    </ul>
                  </li>
                </ul>
                <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                  Community
                  <span class="caret"></span>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li>
                    <a href="../../../community/index.html">Home</a>
                  </li>
                  <li>
                    <a href="../../../community/join.html">Join</a>
                  </li>
                  <li>
                    <a href="../../../license.html">License</a>
                  </li>
                  <li>
                    <a href="../../../docs/dev/development.html">Developer Guide</a>
                  </li>
                  <li>
                    <a href="https://travis-ci.org/hawkular">CI Builds</a>
                  </li>
                </ul></li>
                <li class=""><a href="../../../blog.html">Blog</a></li>
              </ul>
            </div>
          </div>
        </nav>

      <section class="main-banner">
        <div class="container">
          <h1>Client Configuration Guide</h1>
          <p>Hawkular BTM</p>
        </div>
      </section>

	<!--<p><em>24 May 2016</em></p>-->

	<section>
      <div class="container">
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#_configuring_a_client_environment">Configuring a Client Environment</a>
<ul class="sectlevel2">
<li><a href="#_properties">Properties</a></li>
<li><a href="#_container_specific_configuration">Container Specific Configuration</a></li>
<li><a href="#_instrumenting_a_docker_image">Instrumenting a Docker Image</a></li>
</ul>
</li>
<li><a href="#_instrumented_technologies">Instrumented Technologies</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_a_client_environment">Configuring a Client Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section will help you to configure a JVM based client environment to instrument a business application and send business transaction fragment (trace) data to the BTM server.</p>
</div>
<div class="paragraph">
<p>First step is to obtain the Hawkular BTM distribution. If you have not already done so, then see the instructions on the <a href="serverinstall.html">Server Installation</a> page.</p>
</div>
<div class="paragraph">
<p>Once the Hawkular BTM distribution zip has been unpacked, you will find a folder called <strong><em>btm</em></strong>. This folder contains the necessary environment script and agent jar to configure a client JVM environment.</p>
</div>
<div class="paragraph">
<p>This section will explain how to use the supplied environment script, to setup the necessary client configuration, before starting the JVM. However if you would prefer to integrate this environment into your application/container configuration, then simply copy the entries from the contained <strong><em>setenv.sh</em></strong> script, moving the jar into an appropriate location.</p>
</div>
<div class="paragraph">
<p>To configure a client environment, simply run the <strong><em>setenv.sh</em></strong> script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">. &lt;BTM_DISTRIBUTION&gt;/btm/setenv.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the <em>JAVA_OPTS</em> environment variable with the appropriate arguments to instrument any technology for which instrumentation rules have been defined.</p>
</div>
<div class="sect2">
<h3 id="_properties">Properties</h3>
<div class="paragraph">
<p>The properties that can be supplied to the client collector mechanism are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hawkular-btm.uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI for the BTM server. The default value is <em><a href="http://localhost:8180/hawkular/btm" class="bare">http://localhost:8180/hawkular/btm</a></em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hawkular-btm.config.refresh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional business transaction configuration refresh interval (in seconds).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hawkular-btm.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username to use with the REST client when communicating with the BTM server. The default is <em>jdoe</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hawkular-btm.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to use with the REST client when communicating with the BTM server. The default is <em>password</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hawkular-btm.log.level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The logging level to use when reporting client collector information to the console (uses Java Util Logging levels. The default is <em>INFO</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_container_specific_configuration">Container Specific Configuration</h3>
<div class="paragraph">
<p>Although the steps above will work in many situations (e.g. Java standalone, Apache Tomcat), some environments have tighter control over the classpath made available to the business applications. Therefore some additional container specific configuration will be required.</p>
</div>
<div class="sect3">
<h4 id="_wildfly_jboss_eap">Wildfly / JBoss EAP</h4>
<div class="paragraph">
<p>Wildfly requires any 'system packages', that need to be generally accessible by any application, to be defined in a system property called <strong><em>jboss.modules.system.pkgs</em></strong>.</p>
</div>
<div class="paragraph">
<p>This property has been preconfigured in the <strong><em>env.sh</em></strong> script so no additional actions are required. However it has been described to highlight the additional step that was required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_karaf">Karaf</h4>
<div class="paragraph">
<p>Edit the <strong><em>etc/config.properties</em></strong> file, within the Karaf installation, and append the following to the <em>org.osgi.framework.bootdelegation</em> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">org.osgi.framework.bootdelegation=...,org.jboss.byteman.*</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_instrumenting_a_docker_image">Instrumenting a Docker Image</h3>
<div class="paragraph">
<p>If a docker image has been defined to run a Java based application, it is possible to instrument it, to collect business transaction data and report it to the BTM server. This can be achieved by creating a <em>derived</em> Docker image, which adds the BTM agent and defines the properties required to communicate with the server.</p>
</div>
<div class="paragraph">
<p>The <em>Dockerfile</em> should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM &lt;Name of image being instrumented&gt;

ENV BTM_VERSION=&lt;BTM Version being used&gt;
ENV BTM_AGENT=/libs/hawkular-btm-agent-rest-$BTM_VERSION.jar

ADD https://repository.jboss.org/nexus/service/local/artifact/maven/redirect?r=releases&amp;g=org.hawkular.btm&amp;a=hawkular-btm-agent-rest&amp;v=$BTM_VERSION&amp;e=jar $BTM_AGENT

ENV JAVA_OPTS -javaagent:$BTM_AGENT=boot:$BTM_AGENT -Dhawkular-btm.uri=\$BTM_URI -Dhawkular-btm.config.refresh=10 -Dhawkular-btm.username=\$BTM_USERNAME -Dhawkular-btm.password=\$BTM_PASSWORD</pre>
</div>
</div>
<div class="paragraph">
<p>The environment variables <em>BTM_URI</em>, <em>BTM_USERNAME</em> and <em>BTM_PASSWORD</em> would be supplied at runtime.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instrumented_technologies">Instrumented Technologies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section lists the technologies that have instrumentation rules defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Camel (core only, but this provides details of various components that are called)</p>
</li>
<li>
<p>HTTP clients</p>
<div class="ulist">
<ul>
<li>
<p>Java HttpURLConnection</p>
</li>
<li>
<p>Apache httpclient</p>
</li>
<li>
<p>RESTEasy JAX-RS client</p>
</li>
</ul>
</div>
</li>
<li>
<p>JMS</p>
</li>
<li>
<p>Servlet</p>
</li>
<li>
<p>Restlet</p>
</li>
<li>
<p>JDBC</p>
</li>
<li>
<p>EJB (within Wildfly / JBoss EAP)</p>
</li>
<li>
<p>SwitchYard</p>
</li>
<li>
<p>RxJava</p>
</li>
<li>
<p>Netty</p>
</li>
</ul>
</div>
</div>
</div>
      </div>
    </section>

		</div>
		<div id="push"></div>
    </div>

    <section class="redhat clearfix">
      <div class="container">
        <p class="pull-left">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="../../..//img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit pull-right">&copy; 2015 | Hawkular is released under <a href="/license.html">Apache License v2.0</a></p>
    <p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p>
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="../../../js/jbossorg-tabzilla.js"></script>
    <script src="../../../js/behavior.js"></script>
    <script src="../../../js/prettify.js"></script>
    <script src="../../../js//ekko-lightbox.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
